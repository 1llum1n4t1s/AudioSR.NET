<Window
    x:Class="AudioSR.NET.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:AudioSR.NET"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="AudioSR.NET - オーディオ超解像ツール"
    Width="900"
    Height="600"
    AllowDrop="True"
    Closing="Window_Closing"
    DragOver="Window_DragOver"
    Drop="Window_Drop"
    Icon="icon/app.ico"
    Loaded="Window_Loaded"
    mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  初期化オーバーレイパネル  -->
        <Grid
            x:Name="InitializeOverlayPanel"
            Grid.Row="0"
            Grid.RowSpan="3"
            Panel.ZIndex="999"
            Background="#90000000"
            Visibility="Collapsed">
            <StackPanel
                Width="400"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
                <TextBlock
                    Margin="0,0,0,20"
                    HorizontalAlignment="Center"
                    FontSize="18"
                    FontWeight="Bold"
                    Foreground="White"
                    Text="AudioSR.NET を初期化中..." />
                <TextBlock
                    x:Name="InitializeStatusText"
                    Margin="0,0,0,10"
                    HorizontalAlignment="Center"
                    Foreground="White"
                    Text="依存パッケージをインストール中..." />
                <ProgressBar
                    x:Name="InitializeProgressBar"
                    Height="30"
                    Margin="20,0"
                    Background="#CCCCCC"
                    Maximum="100"
                    Value="0" />
                <TextBlock
                    x:Name="InitializeProgressText"
                    Margin="0,10,0,0"
                    HorizontalAlignment="Center"
                    FontSize="12"
                    Foreground="White"
                    Text="0/10" />
            </StackPanel>
        </Grid>

        <!--  処理実行中オーバーレイパネル  -->
        <Grid
            x:Name="ProcessingOverlayPanel"
            Grid.Row="0"
            Grid.RowSpan="3"
            Panel.ZIndex="998"
            Background="#90000000"
            Visibility="Collapsed">
            <StackPanel
                Width="500"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
                <TextBlock
                    Margin="0,0,0,25"
                    HorizontalAlignment="Center"
                    FontSize="20"
                    FontWeight="Bold"
                    Foreground="White"
                    Text="AudioSR 処理を実行中..." />

                <TextBlock
                    x:Name="ProcessingFileText"
                    Margin="0,0,0,5"
                    HorizontalAlignment="Center"
                    FontSize="14"
                    Foreground="White"
                    Text="ファイル名..." />
                <TextBlock
                    x:Name="ProcessingStatusText"
                    Margin="0,0,0,15"
                    HorizontalAlignment="Center"
                    FontSize="12"
                    Foreground="#AAA"
                    Text="準備中..." />

                <ProgressBar
                    x:Name="ProcessingProgressBar"
                    Height="30"
                    Margin="40,0"
                    Background="#CCCCCC"
                    Maximum="100"
                    Value="0" />

                <Grid Margin="40,10,40,0">
                    <TextBlock
                        x:Name="ProcessingDetailText"
                        HorizontalAlignment="Left"
                        FontSize="12"
                        Foreground="White"
                        Text="ステップ: 0/100" />
                    <TextBlock
                        x:Name="ProcessingOverallText"
                        HorizontalAlignment="Right"
                        FontSize="12"
                        Foreground="White"
                        Text="全体進捗: 0/0" />
                </Grid>

                <Button
                    Width="120"
                    Height="35"
                    Margin="0,30,0,0"
                    Background="#FF4444"
                    BorderThickness="0"
                    Click="StopProcessing_Click"
                    Content="処理を中断"
                    Foreground="White">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="5" />
                        </Style>
                    </Button.Resources>
                </Button>
            </StackPanel>
        </Grid>

        <!--  設定パネル  -->
        <GroupBox
            Grid.Row="0"
            Margin="10"
            Header="設定">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!--  Python設定：プロジェクト内Pythonを使用するためUI削除  -->

                <!--  モデル設定  -->
                <Label
                    Grid.Row="1"
                    Grid.Column="0"
                    Margin="5"
                    Content="モデル:" />
                <ComboBox
                    x:Name="cmbModel"
                    Grid.Row="1"
                    Grid.Column="1"
                    Margin="5">
                    <ComboBoxItem Content="basic (一般音声・音楽)" />
                    <ComboBoxItem Content="speech (音声特化)" />
                </ComboBox>

                <!--  処理設定  -->
                <Label
                    Grid.Row="2"
                    Grid.Column="0"
                    Margin="5"
                    Content="DDIMステップ(値が大きいほど高品質):" />
                <StackPanel
                    Grid.Row="2"
                    Grid.Column="1"
                    Orientation="Horizontal">
                    <Slider
                        x:Name="sliderDdimSteps"
                        Width="150"
                        Margin="5"
                        Maximum="100"
                        Minimum="10"
                        Value="{Binding DdimSteps}" />
                    <TextBlock VerticalAlignment="Center" Text="{Binding Value, ElementName=sliderDdimSteps}" />
                </StackPanel>

                <Label
                    Grid.Row="2"
                    Grid.Column="2"
                    Margin="5"
                    Content="ガイダンススケール(値が高いほど特徴的):" />
                <StackPanel
                    Grid.Row="2"
                    Grid.Column="3"
                    Orientation="Horizontal">
                    <Slider
                        x:Name="sliderGuidanceScale"
                        Width="150"
                        Margin="5"
                        IsSnapToTickEnabled="True"
                        Maximum="10"
                        Minimum="1"
                        TickFrequency="0.5"
                        Value="{Binding GuidanceScale}" />
                    <TextBlock VerticalAlignment="Center" Text="{Binding Value, ElementName=sliderGuidanceScale}" />
                </StackPanel>

                <Label
                    Grid.Row="3"
                    Grid.Column="0"
                    Margin="5"
                    Content="乱数シード(同じ値で再現性あり):" />
                <StackPanel
                    Grid.Row="3"
                    Grid.Column="1"
                    Orientation="Horizontal">
                    <TextBox
                        x:Name="txtSeed"
                        Width="100"
                        Margin="5"
                        IsEnabled="{Binding IsSeedEnabled}">
                        <TextBox.Text>
                            <Binding
                                NotifyOnValidationError="True"
                                Path="Seed"
                                UpdateSourceTrigger="PropertyChanged"
                                ValidatesOnExceptions="True">
                                <Binding.ValidationRules>
                                    <local:SeedValidationRule />
                                </Binding.ValidationRules>
                            </Binding>
                        </TextBox.Text>
                        <TextBox.ToolTip>
                            <TextBlock>
                                ・0〜9223372036854775807の整数値を設定可能
                                ・同じ値を使うと同じ結果が得られます
                                ・好みの結果が得られたら値をメモしておくと同じ効果を再現できます
                                ・特に指定がなければランダムチェックボックスをオンにしてください
                            </TextBlock>
                        </TextBox.ToolTip>
                    </TextBox>
                    <CheckBox
                        Margin="5"
                        VerticalAlignment="Center"
                        Content="ランダム"
                        IsChecked="{Binding UseRandomSeed}" />
                </StackPanel>

                <!--  出力先設定  -->
                <Label
                    Grid.Row="3"
                    Grid.Column="2"
                    Margin="5"
                    Content="出力フォルダ:" />
                <Grid Grid.Row="3" Grid.Column="3">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBox
                        x:Name="txtOutputFolder"
                        Grid.Column="0"
                        Margin="5"
                        Text="{Binding OutputFolder}" />
                    <Button
                        Grid.Column="1"
                        Margin="5"
                        Click="BrowseOutputFolder_Click"
                        Content="参照..." />
                </Grid>

                <Label
                    Grid.Row="4"
                    Grid.Column="2"
                    Margin="5"
                    Content="上書き:" />
                <CheckBox
                    Grid.Row="4"
                    Grid.Column="3"
                    Margin="5"
                    Content="出力ファイルを上書きする"
                    IsChecked="{Binding OverwriteOutputFiles}" />
            </Grid>
        </GroupBox>

        <!--  ファイルリスト  -->
        <GroupBox
            Grid.Row="1"
            Margin="10"
            Header="ファイルリスト">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ListView
                    x:Name="lvFiles"
                    Grid.Row="0"
                    ItemsSource="{Binding FileList}">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn
                                Width="180"
                                DisplayMemberBinding="{Binding Name}"
                                Header="ファイル名" />
                            <GridViewColumn
                                Width="Auto"
                                DisplayMemberBinding="{Binding Path}"
                                Header="パス" />
                            <GridViewColumn
                                Width="80"
                                DisplayMemberBinding="{Binding Status}"
                                Header="ステータス" />
                        </GridView>
                    </ListView.View>
                </ListView>

                <StackPanel
                    Grid.Row="1"
                    HorizontalAlignment="Right"
                    Orientation="Horizontal">
                    <Button
                        Margin="5"
                        Click="AddFiles_Click"
                        Content="ファイル追加" />
                    <Button
                        Margin="5"
                        Click="RemoveFiles_Click"
                        Content="削除" />
                    <Button
                        Margin="5"
                        Click="ClearFiles_Click"
                        Content="リストクリア" />
                </StackPanel>
            </Grid>
        </GroupBox>

        <!--  操作ボタン  -->
        <StackPanel
            Grid.Row="2"
            Margin="10"
            HorizontalAlignment="Right"
            Orientation="Horizontal">
            <Button
                Width="100"
                Margin="5"
                Click="SaveSettings_Click"
                Content="設定保存" />
            <Button
                Width="100"
                Margin="5"
                Click="StartProcessing_Click"
                Content="処理開始" />
            <Button
                Width="100"
                Margin="5"
                Click="StopProcessing_Click"
                Content="処理停止" />
            <Button
                Width="120"
                Margin="5"
                Click="RetryEmbeddedPython_Click"
                Content="ランタイム再試行" />
            <Button
                Width="100"
                Margin="5"
                Click="ShowEmbeddedPythonHelp_Click"
                Content="ヘルプ表示" />
        </StackPanel>
    </Grid>
</Window>
